# 9.4 优化一下

>##### 学习Tips：在前面的课程音乐进行停止和暂停时会出现BUG，在本次课进行修复，并将冗余的代码提炼到单独的方法中。

## 1. 学习视频

<iframe frameborder="0" width="640" height="498" src="https://v.qq.com/iframe/player.html?vid=z0180bhmznp&tiny=0&auto=0" allowfullscreen></iframe>

## 2. 项目优化

```
  mp.setOnCompletionListener(new OnCompletionListener() {				
      @Override
      public void onCompletion(MediaPlayer mp) {
        mp.stop();
        mp.reset();
        if(position == mp3s.size() - 1) {
          position = 0;
        } else {
          position ++;
        }
        try {
          mp.setDataSource(Path + mp3s.get(position).getMp3name());
          mp.prepare();
          seekbar.setMax(mp.getDuration()); 
          mp.start();
          mp3title.setText(mp3s.get(position).getMp3name().replace(".mp3", ""));
          mp3singer.setText(mp3s.get(position).getMp3singer());			
          playtime.setText(sdf.format(new Date(mp.getCurrentPosition())));//当前的播放位置
          lasttime.setText(sdf.format(new Date(mp.getDuration())));//总共的播放时间
        } catch (Exception e) {
          e.printStackTrace();
        }
       }
  }); //end mp.setOnCompletionListener
```